/**
 * éæš´åŠ›æ²Ÿé€šç¿»è¯‘å™¨
 * å°†å¸¦æœ‰æƒ…ç»ªçš„æŠ±æ€¨è½¬æ¢ä¸ºå§”å©‰ã€å¾—ä½“çš„å»ºè®®
 */

interface TranslationRule {
  keywords: string[];
  templates: string[];
}

const rules: TranslationRule[] = [
  {
    keywords: ['åµ', 'å™ª', 'å£°éŸ³å¤§', 'å¤ªå“'],
    templates: [
      'æˆ‘æœ€è¿‘ç¡çœ è´¨é‡ä¸å¤ªå¥½ï¼Œèƒ½å¦åœ¨æ™šä¸Š {time} åé™ä½ä¸€äº›éŸ³é‡å‘¢ï¼Ÿéå¸¸æ„Ÿè°¢ï¼',
      'æˆ‘ç†è§£ä½ çš„éœ€æ±‚ï¼Œä¸è¿‡æˆ‘å¯¹å£°éŸ³æ¯”è¾ƒæ•æ„Ÿï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½çº¦å®šä¸€ä¸ª"å®‰é™æ—¶æ®µ"ï¼Ÿ',
      'å’±ä»¬å¯ä»¥ä¸€èµ·åˆ¶å®šä¸ªä½œæ¯æ—¶é—´è¡¨å—ï¼Ÿè¿™æ ·å¤§å®¶éƒ½èƒ½ä¼‘æ¯å¥½ ğŸ˜Š'
    ]
  },
  {
    keywords: ['è„', 'ä¹±', 'åƒåœ¾', 'ä¸æ”¶æ‹¾', 'è‡­'],
    templates: [
      'æˆ‘ä»¬ä¸€èµ·åˆ¶å®šä¸ªå«ç”Ÿå€¼æ—¥è¡¨æ€ä¹ˆæ ·ï¼Ÿè¿™æ ·å¤§å®¶éƒ½èƒ½ä½å¾—èˆ’æœä¸€äº›',
      'æˆ‘æ³¨æ„åˆ° {area} éœ€è¦æ•´ç†ä¸€ä¸‹ï¼Œæˆ‘ä»¬è½®æµè´Ÿè´£å¦‚ä½•ï¼Ÿ',
      'ä¿æŒå®¿èˆæ•´æ´å¯¹å¤§å®¶éƒ½å¥½ï¼Œè¦ä¸æˆ‘ä»¬çº¦å®šæ¯å‘¨æœ«ä¸€èµ·å¤§æ‰«é™¤ï¼Ÿ'
    ]
  },
  {
    keywords: ['ç†¬å¤œ', 'å¼€ç¯', 'å½±å“ç¡è§‰'],
    templates: [
      'æˆ‘ç†è§£ä½ éœ€è¦å­¦ä¹ /å·¥ä½œï¼Œä¸è¿‡èƒ½å¦è€ƒè™‘ä½¿ç”¨å°ç¯æˆ–å»è‡ªä¹ å®¤å‘¢ï¼Ÿ',
      'å’±ä»¬èƒ½ä¸èƒ½çº¦å®šä¸€ä¸ªç†„ç¯æ—¶é—´ï¼Ÿæˆ‘å¯ä»¥å‡†å¤‡çœ¼ç½©ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨å°å°ç¯',
      'æˆ‘æœ€è¿‘éœ€è¦æ—©èµ·ï¼Œèƒ½å¦åœ¨ {time} åé™ä½ç¯å…‰äº®åº¦ï¼Ÿè°¢è°¢ç†è§£ï¼'
    ]
  },
  {
    keywords: ['ç©ºè°ƒ', 'æ¸©åº¦', 'å¤ªå†·', 'å¤ªçƒ­'],
    templates: [
      'æˆ‘å¯¹æ¸©åº¦æ¯”è¾ƒæ•æ„Ÿï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½æŠŠç©ºè°ƒè®¾åœ¨ {temp}Â°C å·¦å³ï¼Ÿ',
      'è¦ä¸æˆ‘ä»¬æŠ•ç¥¨å†³å®šç©ºè°ƒæ¸©åº¦ï¼Ÿæˆ–è€…è½®æµæ§åˆ¶ï¼Ÿ',
      'æˆ‘å¯ä»¥å¤šç›–è¢«å­/å°‘ç›–è¢«å­ï¼Œä½†èƒ½å¦æŠŠæ¸©åº¦è°ƒåˆ° {temp}Â°C å‘¢ï¼Ÿ'
    ]
  },
  {
    keywords: ['å€Ÿä¸œè¥¿', 'ä¸è¿˜', 'ç”¨æˆ‘çš„'],
    templates: [
      'æˆ‘å¾ˆä¹æ„åˆ†äº«ï¼Œä¸è¿‡èƒ½å¦åœ¨ç”¨ä¹‹å‰å…ˆé—®ä¸€ä¸‹æˆ‘å‘¢ï¼Ÿ',
      'å’±ä»¬å¯ä»¥å»ºä¸ª"å…±äº«æ¸…å•"ï¼Œæ˜ç¡®å“ªäº›å¯ä»¥å…±ç”¨ï¼Œå“ªäº›éœ€è¦è¯¢é—®',
      'æˆ‘æ³¨æ„åˆ° {item} è¢«ä½¿ç”¨äº†ï¼Œä¸‹æ¬¡èƒ½æå‰å‘Šè¯‰æˆ‘å—ï¼Ÿè°¢è°¢ï¼'
    ]
  }
];

/**
 * ç¿»è¯‘æŠ±æ€¨ä¸ºå§”å©‰å»ºè®®
 */
export function translateToPolite(complaint: string): string[] {
  // æ£€æµ‹åŒ¹é…çš„è§„åˆ™
  const matchedRules = rules.filter(rule => 
    rule.keywords.some(keyword => complaint.includes(keyword))
  );
  
  if (matchedRules.length === 0) {
    return [
      'æˆ‘æƒ³å’Œä½ èŠèŠå…³äºå®¿èˆçš„ä¸€äº›äº‹æƒ…ï¼Œæ–¹ä¾¿çš„è¯æˆ‘ä»¬æ‰¾ä¸ªæ—¶é—´æ²Ÿé€šä¸€ä¸‹å¥½å—ï¼Ÿ',
      'æˆ‘æœ‰äº›æƒ³æ³•æƒ³å’Œä½ åˆ†äº«ï¼Œå¸Œæœ›æˆ‘ä»¬èƒ½ä¸€èµ·è®©å®¿èˆç”Ÿæ´»æ›´èˆ’é€‚',
      'æˆ‘ä»¬èƒ½åä¸‹æ¥å¥½å¥½è°ˆè°ˆå—ï¼Ÿæˆ‘ç›¸ä¿¡é€šè¿‡æ²Ÿé€šèƒ½æ‰¾åˆ°åŒæ–¹éƒ½æ»¡æ„çš„è§£å†³æ–¹æ¡ˆ'
    ];
  }
  
  // åˆå¹¶æ‰€æœ‰åŒ¹é…è§„åˆ™çš„æ¨¡æ¿
  const allTemplates = matchedRules.flatMap(rule => rule.templates);
  
  // éšæœºé€‰æ‹© 3 ä¸ªä¸åŒçš„æ¨¡æ¿
  const shuffled = allTemplates.sort(() => Math.random() - 0.5);
  return shuffled.slice(0, 3);
}

/**
 * å¡«å……æ¨¡æ¿ä¸­çš„å ä½ç¬¦
 */
export function fillTemplate(template: string, params: Record<string, string>): string {
  let result = template;
  Object.entries(params).forEach(([key, value]) => {
    result = result.replace(`{${key}}`, value);
  });
  return result;
}

/**
 * åˆ†ææŠ±æ€¨çš„æƒ…ç»ªå¼ºåº¦ (0-100)
 */
export function analyzeEmotionIntensity(text: string): number {
  const strongWords = ['å¤ª', 'éå¸¸', 'ç‰¹åˆ«', 'è¶…çº§', 'æå…¶', 'çœŸçš„', 'å®åœ¨'];
  const negativeWords = ['è®¨åŒ', 'çƒ¦', 'å—ä¸äº†', 'å¿ä¸äº†', 'æ°”æ­»', 'å´©æºƒ'];
  
  let intensity = 30; // åŸºç¡€å¼ºåº¦
  
  strongWords.forEach(word => {
    if (text.includes(word)) intensity += 10;
  });
  
  negativeWords.forEach(word => {
    if (text.includes(word)) intensity += 15;
  });
  
  // æ£€æµ‹æ„Ÿå¹å·å’Œé—®å·
  intensity += (text.match(/[ï¼!]/g) || []).length * 5;
  intensity += (text.match(/[ï¼Ÿ?]/g) || []).length * 3;
  
  return Math.min(100, intensity);
}
